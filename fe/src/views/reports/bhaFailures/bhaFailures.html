<div class="report bhaFailures">
  <div class="frame" cg-busy="$ctrl.isLoading">
    <div class="margin-bottom clearfix">
      <div class="pull-left">
        <h3 class="text-muted hug dropdown">
          BHA Failures
          <small class="chart-sub-title dropdown-toggle" data-toggle="dropdown">From {{ $ctrl.lastSearch.startDate | date:'dd/MMM/yyyy' }} to {{ $ctrl.lastSearch.endDate | date:'dd/MMM/yyyy' }}</small>

          <form name="form" class="dropdown-menu" ng-submit="$ctrl.load()">
            <div class="col-12 padding-sm">
              <p>From <small class="text-danger" ng-show="form.startDate.$error.max">Invalid date.</small></p>
              <div class="input-group">
                <span class="input-group-addon" id="addon"><span class="glyphicon glyphicon-calendar" aria-hidden="true"></span></span>
                <input class="form-control" type="date" ng-model="$ctrl.query.startDate" aria-describedby="addon" max="{{ $ctrl.query.endDate | date:'yyyy-MM-dd' }}" name="startDate" ng-disabled="$ctrl.isLoading" required />
              </div>
            </div>

            <div class="col-12 padding-sm">
              <p>To <small class="text-danger" ng-show="form.endDate.$error.min">Invalid date.</small></p>
              <div class="input-group">
                <span class="input-group-addon" id="addon"><span class="glyphicon glyphicon-calendar" aria-hidden="true"></span></span>
                <input class="form-control" type="date" ng-model="$ctrl.query.endDate" aria-describedby="addon" min="{{ $ctrl.query.startDate | date:'yyyy-MM-dd' }}" name="endDate" ng-disabled="$ctrl.isLoading" required />
              </div>
            </div>

            <div class="col-12 padding-sm">
              <button type="submit" ng-disabled="form.$invalid || $ctrl.isLoading" class="btn btn-primary btn-outline btn-block">Ok</button>
            </div>
          </form>
        </h3>
      </div>
    </div>

    <div class="bordered">
      <table class="table table-hover hug" ng-table="$ctrl.tableParams">
        <colgroup>
          <col>
          <col width="33.33%">
          <col width="33.33%">
          <col width="33.33%">
        </colgroup>
        <thead>
          <th></th>
          <th class="text-center">BHA</th>
          <th class="text-center">Job Number</th>
          <th class="text-center">Failure</th>
        </thead>
        <tbody>
          <!-- <bha-failure></bha-failure> -->
          <tr ng-repeat-start="item in $data">
            <td class="table-numeration">{{ $ctrl.currentIndex + $index + 1 }}</td>
            <td class="text-center">
              <a href="" class="bold" drilldown="{ title: item.bha.name, component: 'bhasView', id: item.bha.id }">
                {{ item.bha.name }}
              </a>
            </td>
            <td class="text-center">
              <a href="" class="bold" drilldown="{ title: item.job.jobNumber, component: 'jobsView', id: item.job.jobId }">
                {{ item.job.jobNumber | available }}
              </a>
            </td>
            <td class="text-center" ng-click="item.isCollapsed = !item.isCollapsed">
              <a href="" class="bold">
                {{ item.failureType.itemValue }}
              </a>
            </td>
          </tr>
          <!-- collapsable row -->
          <tr ng-repeat-end ng-if="item.isCollapsed">
            <td colspan="4" class="sub-table-frame">
              {{ item.description }}
            </td>
          </tr>
          <!-- /collapsable row -->
        </tbody>
      </table>
    </div>
  </div>
</div>
